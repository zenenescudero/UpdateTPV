
create table Inventario
(
  Id bigint not null PRIMARY key,
  ArticuloId bigint not null,
  SucursalId int not null,
  Saldo decimal(15,4) not null,
  Enviado int default 0,
  Version bigint not null default 1
)


INSERT [dbo].[Columnas] ([Id], [Tabla], [Campo], [Descripcion], [Largo], [Formato]) VALUES (424, N'ReporteTurnoVentaPDF', N'Operacion', N'OperaciÃ³n', 50, N'')
INSERT [dbo].[Columnas] ([Id], [Tabla], [Campo], [Descripcion], [Largo], [Formato]) VALUES (425, N'ReporteTurnoVentaPDF', N'Fecha', N'Fecha', 55, N'dd-MM-yyyy')
INSERT [dbo].[Columnas] ([Id], [Tabla], [Campo], [Descripcion], [Largo], [Formato]) VALUES (426, N'ReporteTurnoVentaPDF', N'FormaPagoDesc', N'Forma de Pago', 75, N'')
INSERT [dbo].[Columnas] ([Id], [Tabla], [Campo], [Descripcion], [Largo], [Formato]) VALUES (428, N'ReporteTurnoVentaPDF', N'Cliente', N'Cliente', 185, N'')
INSERT [dbo].[Columnas] ([Id], [Tabla], [Campo], [Descripcion], [Largo], [Formato]) VALUES (429, N'ReporteTurnoVentaPDF', N'QUIEN', N'Usuario', 70, N'')
INSERT [dbo].[Columnas] ([Id], [Tabla], [Campo], [Descripcion], [Largo], [Formato]) VALUES (430, N'ReporteTurnoVentaPDF', N'Serie', N'Serie', 55, N'')
INSERT [dbo].[Columnas] ([Id], [Tabla], [Campo], [Descripcion], [Largo], [Formato]) VALUES (431, N'ReporteTurnoVentaPDF', N'Folio', N'Folio', 65, N'')
INSERT [dbo].[Columnas] ([Id], [Tabla], [Campo], [Descripcion], [Largo], [Formato]) VALUES (432, N'ReporteTurnoVentaPDF', N'Cargo', N'Total', 85, N'c2')
SET IDENTITY_INSERT [dbo].[Columnas] OFF


/*

delete from from DB_Paraiso.dbo.InventarioMovimientos 

delete from from DB_Paraiso.dbo.Inventario

delete from from DB_Paraiso.dbo.Articulos


delete from DB_Paraiso.dbo.DocRelPago
delete from DB_Paraiso.dbo.ComplementoPago

delete from DB_Paraiso.dbo.FacturasDetalle
delete from DB_Paraiso.dbo.Facturas

delete from DB_Paraiso.dbo.NotasCreditoDetalle
delete from DB_Paraiso.dbo.NotasCredito

delete from DB_Paraiso.dbo.CfdiCancelados
delete from DB_Paraiso.dbo.CfdiRelacionado

delete from DB_Paraiso.dbo.EstadoCuenta

delete from DB_Paraiso.dbo.TicketsDetalle
delete from DB_Paraiso.dbo.ticketsCancelados
delete from DB_Paraiso.dbo.Tickets

delete from DB_Paraiso.dbo.OrdenCompraDetalle
delete from DB_Paraiso.dbo.OrdenCompra

delete from DB_Paraiso.dbo.PresupuestoDetalle
delete from DB_Paraiso.dbo.Presupuesto

delete from DB_Paraiso.dbo.TraspasoDetalle
delete from DB_Paraiso.dbo.Traspaso

/////////////////////////

delete from from DB_Mendez.dbo.InventarioMovimientos 

delete from from DB_Mendez.dbo.Inventario

delete from from DB_Mendez.dbo.Articulos

delete from DB_Mendez.dbo.DocRelPago
delete from DB_Mendez.dbo.ComplementoPago

delete from DB_Mendez.dbo.FacturasDetalle
delete from DB_Mendez.dbo.Facturas

delete from DB_Mendez.dbo.NotasCreditoDetalle
delete from DB_Mendez.dbo.NotasCredito

delete from DB_Mendez.dbo.CfdiCancelados
delete from DB_Mendez.dbo.CfdiRelacionado

delete from DB_Mendez.dbo.EstadoCuenta

delete from DB_Mendez.dbo.TicketsDetalle
delete from DB_Mendez.dbo.ticketsCancelados
delete from DB_Mendez.dbo.Tickets

delete from DB_Mendez.dbo.OrdenCompraDetalle
delete from DB_Mendez.dbo.OrdenCompra

delete from DB_Mendez.dbo.PresupuestoDetalle
delete from DB_Mendez.dbo.Presupuesto

delete from DB_Mendez.dbo.TraspasoDetalle
delete from DB_Mendez.dbo.Traspaso



*/


  insert into [ConfiguracionApp] values(19,'PlantillaPDF','Paraiso')


if(select count(*) from [UsuarioOpcionesMenu] where UsuarioId = (select Id from Usuarios where [Login]='ADMIN') ) != (select count(*) from OpcionesMenu) 
begin
    delete from [UsuarioOpcionesMenu] where UsuarioId = (select Id from Usuarios where [Login]='ADMIN') 

  insert into [UsuarioOpcionesMenu](UsuarioId,OpcionId,Crear,Editar,Eliminar,Consultar) 
        select s.Id,o.Id,1,1,1,1 from Usuarios s, OpcionesMenu o
        where [Login]='ADMIN'
end

if(select count(*) from [UsuariosSucursal] where UsuarioId = (select Id from Usuarios where [Login]='ADMIN') ) != (select count(*) from Sucursales) 
begin
  delete from [UsuariosSucursal] where UsuarioId = (select Id from Usuarios where [Login]='ADMIN')

  insert into [UsuariosSucursal](SucursalId, UsuarioId) 
        select s.Id, u.Id from Sucursales s, Usuarios u
        where [Login]='ADMIN'
end



create table OrdenCompra(
  Id bigint not null PRIMARY key,
  SucursalId int not null,
  ProveedorId bigint not null,
  FolioInterno bigint not null,
  Serie varchar(5) null,
  Folio varchar(20) null,
  UUID varchar(50) null,
  FechaSolicitud datetime null,
  FechaEntrega datetime null,
  FechaRegistro datetime null,
  SubTotal decimal(15,2) not null,
  Impuestos decimal(15,2) not null,
  Descuento decimal(15,2) not null,
  Total decimal(15,2) not null,
  UsuarioId int null,
  QUIEN VARCHAR(50),
  CUANDO datetime null,
  EQUIPO varchar(50) null,
  Enviado int default 0,
  [Version] bigint not null default 1
)

go

create table OrdenCompraDetalle(
  Id bigint not null PRIMARY key,
  IdOrdenCompra bigint not null,
  SucursalId int not null,
  Partida int not null,
  ClaveProdServ varchar(10) null,
  ClaveUnidad varchar(10) null,
  CodigoProveedor varchar(30) null, 
  Articulo varchar(15) not null,
  Descripcion varchar(1000) not null,
  ArticuloId bigint not null,
  ArticuloSis varchar(15) not null,
  DescripcionSis varchar(1000) not null,  
  Cantidad decimal(10,3) not null,  
  Unidad varchar(50) not null,
  ValorUnitario decimal(15,2) not null,
  Importe decimal(15,2) not null,
  Descuento decimal(15,2) not null,
  ObjetoImp varchar(5) null,
  BaseIva decimal(15 ,2) not null,
  Iva decimal(15,4) not null,
  IvaVal decimal(15,4) not null,
  BaseIeps decimal(15,2) not null,
  Ieps decimal(15,2) not null,
  IepsVal decimal(15,2) not null, 
  TotalUnitario decimal(15,2) not null,
  Total decimal(15,2) not null,
  UsuarioId int null,
  QUIEN VARCHAR(50) null,
  CUANDO datetime null,
  EQUIPO varchar(50),
  Enviado int default 0,  
  [Version] bigint not null default 1
)

insert into Columnas(Tabla,Campo,Descripcion,Largo,Formato)
values('OrdenCompra','FolioInterno', 'Folio Interno', 70,'')


create table FoliosInternos(
  Id bigint not null identity(1,1) primary key,
  Tabla varchar(50) not null unique,
  Folio bigint not null
)


delete from Columnas where Tabla = 'OrdenCompra' and Campo ='Id'


create table Tickets(
  Id bigint not null PRIMARY key,
  SucursalId int not null,
  ClienteId bigint null,
  Observaciones varchar(500) null,
  Fecha datetime null,
  FolioInterno bigint not null,
  Serie varchar(5) null,
  Folio int null,
  UUID varchar(50) null,
  Moneda varchar(5) null,
  TipoCambio decimal(15,6) null,
  Total decimal(15,2) null,
  FormaPago varchar(5) null,
  FormaPagoDesc varchar(50) null,
  UsoCFDI varchar(5) null,
  UsoCFDIDesc varchar(50) null,
  MetodoPago varchar(5) null,
  MetodoPagoDesc varchar(50) null,
  Banco varchar(50) null,
  Referencia varchar(50) null,
  Plazo int not null default 0,
  UsuarioId int null,
  QUIEN VARCHAR(50) null,
  CUANDO datetime null,
  EQUIPO varchar(50),
  Cancelado int default 0,
  Facturado int default 0,
  Enviado int default 0,  
  [Version] bigint not null default 1
)


insert into Columnas(Tabla,Campo,Descripcion,Largo,Formato)
values('tickets','FolioInterno', 'Folio Interno', 70,'')


delete from Columnas where  Tabla = 'tickets' and Campo = 'Id'


create table Presupuesto(
  Id bigint not null PRIMARY KEY,
  SucursalId int not null,
  ClienteId bigint null,
  Observaciones varchar(500) null,
  FolioInterno bigint not null,
  Fecha datetime null,
  Total decimal(15,2) null,
  UsuarioId int null,
  QUIEN VARCHAR(50) null,
  CUANDO datetime null,
  EQUIPO varchar(50)
)



alter table InventarioMovimientos add FolioInterno bigint not null default 0

insert into Columnas(Tabla,Campo,Descripcion,Largo,Formato)
values('Presupuesto','FolioInterno', 'Folio Interno', 70,'')


insert into Columnas(Tabla,Campo,Descripcion,Largo,Formato)
values('Inventario','FolioInterno', 'Folio Interno', 70,'')


delete from Columnas where  Tabla = 'Inventario' and Campo = 'Id'
delete from Columnas where  Tabla = 'Inventario' and Campo = 'IdTicket'
delete from Columnas where  Tabla = 'Inventario' and Campo = 'FolioCompra'


insert into FoliosInternos(Tabla,Folio)
values('InventarioMovimientos',10000)

insert into FoliosInternos(Tabla,Folio)
values('CAT_CONCEPTOSINV',300)



  insert into [ConfiguracionApp] values(20,'DiasConsultaAtras','30')


insert into FoliosInternos(Tabla,Folio)
values('Clientes',20000)

alter table facturas alter column [MetodoPago] varchar(50) null


alter table Traspaso add FolioInterno bigint not null default 0
insert into FoliosInternos(Tabla,Folio) values('Traspaso',1)

insert into Columnas(Tabla,Campo,Descripcion,Largo,Formato)
values('Traspaso','FolioInterno', 'Folio Interno', 70,'')



alter table NotasCredito add EnviadoCliente int default 0
alter table ComplementoPago add EnviadoCliente int default 0


update Columnas set Largo = 70  where Tabla = 'ReporteVentas' and Campo = 'Fecha'


  insert into [ConfiguracionApp] values(21,'ReporteEspecialVentas','Paraiso')



insert into FoliosInternos(Tabla,Folio)
values('Articulos', 10000)

insert into FoliosInternos(Tabla,Folio)
values('Marcas', 500)

insert into FoliosInternos(Tabla,Folio)
values('Proveedores', 500)

insert into FoliosInternos(Tabla,Folio)
values('Usuarios', 500)

insert into FoliosInternos(Tabla,Folio)
values('Secciones', 500)

insert into FoliosInternos(Tabla,Folio)
values('Pais', 10)

insert into FoliosInternos(Tabla,Folio)
values('Estado', 10)

insert into FoliosInternos(Tabla,Folio)
values('Municipio', 10)

insert into FoliosInternos(Tabla,Folio)
values('ConceptoInventario', 500)



insert into ConfiguracionApp(Id,Parametro,Valor) 
values(23,'IncrementarFuente', '3')

insert into ConfiguracionApp(Id,Parametro,Valor) 
values(24,'IncrementarCabecera', '6')

update Columnas set Largo = '230' where Tabla = 'articulos' and Campo = 'Descripcion'


insert into ConfiguracionApp(Id,Parametro,Valor) 
values(25,'GidPersonalizado', 'ARTICULOS|CLIENTES|ComplementoPago|ConceptoInventario|Estado|Facturas|Inventario
|Marcas|Municipio|NotasCredito|OrdenCompra|OrdenCompraDetalle|Presupuesto|Proveedores|
ReporteCreditos|ReporteExistencias|ReporteNotaC|ReportePagos|ReporteTurno|ReporteVentas
|Secciones|tickets|Traspaso|TraspasoDetalle|Usuario|BuscadorModal|')
select distinct Tabla from Columnas

delete from Columnas where Tabla = 'Clientes' and Campo in('Limite','Pais','LADA','Telefono1','Telefono2', 'Email', 'ACTIVO')


delete from Columnas where Tabla = 'ComplementoPago' and Campo in('Cancelado','TipoCadPago','LugarExpedicion','HistoricoTxt','MontoTotalPagos')


delete from Columnas where Tabla = 'Facturas' and Campo in('HistoricoTxt','Cancelado','InformacionGlobal_PeriodicidadDesc'
,'InformacionGlobal_MesDesc','LugarExpedicion','UUID')


delete from Columnas where Tabla = 'NotasCredito' and Campo in('HistoricoTxt','Cancelado','InformacionGlobal_PeriodicidadDesc'
,'InformacionGlobal_MesDesc','LugarExpedicion','UUID')


delete from Columnas where Tabla = 'ReporteTurno' and Campo in('Historico','Sucursal','Observaciones')


select  * from Columnas where Tabla like 'ReporteExistenciasPDF'

select sum(Largo) from Columnas where Tabla like 'ReporteExistenciasPDF'

delete from Columnas where Tabla like 'ReporteExistenciasPDF' and Campo = 'Seccion'

update Columnas set Largo = '60' where Tabla like 'ReporteExistenciasPDF' and Campo = 'Articulo'
update Columnas set Largo = '250' where Tabla like 'ReporteExistenciasPDF' and Campo = 'Descripcion'
update Columnas set Largo = '60' where Tabla like 'ReporteExistenciasPDF' and Campo = 'Unidad'
update Columnas set Largo = '80' where Tabla like 'ReporteExistenciasPDF' and Campo = 'Existencias'
update Columnas set Largo = '80' where Tabla like 'ReporteExistenciasPDF' and Campo = 'PrecioCompra'


delete from Columnas where Tabla like 'ReportePagosPDF' and Campo = 'FechaPago'
update Columnas set Largo = '80' where Tabla like 'ReportePagosPDF' and Campo = 'Fecha'
update Columnas set Largo = '65' where Tabla like 'ReportePagosPDF' and Campo = 'Documento'
update Columnas set Largo = '65' where Tabla like 'ReportePagosPDF' and Campo = 'Factura'


create table ApiSincronizacion(
Id int not null unique,
Equipo varchar(50) null,
Fecha datetime not null
);

insert into Inventario
(Id,ArticuloId,SucursalId,Saldo,Enviado,[Version])
select (Id + 6000), Id,2,0,1,1 from Articulos where Id not in (select distinct ArticuloId from Inventario where SucursalId = 2);
select * from Inventario;

ALTER TABLE Inventario
ADD CONSTRAINT unique_art_suc UNIQUE (ArticuloId, SucursalId);

comercializadoramendezaldama@gmail.com

/*
insert into Columnas (Tabla,Campo,Descripcion,Largo,Formato)
values('ReporteVentas','Cancelado','Cancelado',60,'');


insert into Columnas (Tabla,Campo,Descripcion,Largo,Formato)
values('ReportePagos','Cancelado','Cancelado',60,'');

insert into Columnas (Tabla,Campo,Descripcion,Largo,Formato)
values('ReporteNotaC','Cancelado','Cancelado',60,'');

delete from Columnas where Tabla = 'ReporteNotaCPDF' and Campo = 'IepsVal'
update Columnas set Largo = 65 where Tabla = 'ReporteNotaCPDF' and Campo = 'Documento'
update Columnas set Largo = 65 where Tabla = 'ReporteNotaCPDF' and Campo = 'Factura'
update Columnas set Largo = 70 where Tabla = 'ReporteNotaCPDF' and Campo = 'FormaPagoDesc'
update Columnas set Largo = 180 where Tabla = 'ReporteNotaCPDF' and Campo = 'Receptor_Nombre'


alter table InventarioMovimientos add Costo decimal(15,4) default 0
alter table InventarioMovimientos add Total decimal(15,4) default 0


insert into Columnas (Tabla,Campo,Descripcion,Largo,Formato)
values('Inventario','Costo','Costo',100,'c2');
insert into Columnas (Tabla,Campo,Descripcion,Largo,Formato)
values('Inventario','Total','Total',120,'c2');

*/



--delete from InventarioMovimientos where SucursalId = 2 and Version > 1
--delete from InventarioMovimientos where SucursalId = 3 and Version > 1

select max(Id) from InventarioMovimientos where SucursalId = 2
and Version = 1

insert into InventarioMovimientos
select ([Id] + 2384)
      ,[IdTicket]
      ,[IdOrdenCompra]
      ,[ArticuloId]
      ,[Articulo]
      ,3 [SucursalId]
      ,[Tipo]
      ,[ConceptoInvId]
      ,[FolioCompra]
      ,[Comentario]
      ,[Entrada]
      ,[Salida]
      ,[UsuarioId]
      ,[QUIEN]
      ,[CUANDO]
      ,[EQUIPO]
      ,[Enviado]
      ,[Version]
      ,[FolioInterno]
      ,[Costo]
      ,[Total] from InventarioMovimientos where SucursalId = 1 and Version = 1

